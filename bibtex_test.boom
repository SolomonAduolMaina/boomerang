module Bibtex_test = 

let LOWERCASE = [a-z]
let UPPERCASE = [A-Z]
let DIGIT = DIGIT
let WSP = WSP

let NAME = UPPERCASE  . (LOWERCASE)*

let LASTCOMMASTART = NAME .  ","  . (WSP . NAME)*

let STARTTOEND = (NAME  . WSP)*  . NAME

let BIBTEXAUTHORLIST = LASTCOMMASTART  . (" and "  . LASTCOMMASTART)*
let BIBTEXAUTHORINFO = "author={"  . BIBTEXAUTHORLIST  . "}"

let AUTAG = "au - "
let TITAG = "ti - "
let JOTAG = "jo - "

let TAGGEDAUTHORDEFNS = AUTAG  . STARTTOEND . ("\n "  . AUTAG . STARTTOEND)*

let bibtex_to_readable_au = synth BIBTEXAUTHORINFO <=> TAGGEDAUTHORDEFNS with
#{string * string}[ "author={Foster, Nathan and Pierce, Benjamin and Bohannon, Aaron}", 
"au - Nathan Foster
 au - Benjamin Pierce
 au - Aaron Bohannon" ]
 
let TITLE = NAME . (WSP . NAME)*
let BIBTEXTITLE = "title={" . TITLE . "}"
let TAGGEDTITLE = TITAG . TITLE

let bibtext_to_readable_title = synth BIBTEXTITLE <=> TAGGEDTITLE with
#{string * string}["title={Boomerang Resourceful Lenses For String Data}", 
 "ti - Boomerang Resourceful Lenses For String Data"]
 
let JOURNAL = NAME . (WSP . NAME)*
let BIBTEXJOURNAL = "journal={"  . JOURNAL  . "}"
let TAGGEDJOURNAL = JOTAG . JOURNAL

let journal_to_readable_journal = synth BIBTEXJOURNAL <=> TAGGEDJOURNAL with
#{string * string}["journal={Principals Of Programming Languages}",
 "jo - Principals Of Programming Languages"]
 
let INSIDE1 = perm #{canonizer}[id (BIBTEXJOURNAL . ",");
id(BIBTEXAUTHORINFO . ","); id (BIBTEXTITLE . ",")] with (id [])

let FULLBIBTEX = id [{]  . INSIDE1  . id [}]

let FULLTAGS = perm #{canonizer}[id TAGGEDAUTHORDEFNS; id TAGGEDTITLE; 
id TAGGEDJOURNAL] with (id [\n])

let bibtext_to_tagged_tester = synth FULLBIBTEX <=> FULLTAGS with
#{string * string}[
"{author={Foster, Nathan and Pierce, Benjamin and Bohannon, Aaron},title={Boomerang Resourceful Lenses For String Data},journal={Principals Of Programming Languages},}"
,
"au - Nathan Foster
 au - Benjamin Pierce
 au - Aaron Bohannon
ti - Boomerang Resourceful Lenses For String Data
jo - Principals Of Programming Languages"
]

(* test bibtext_to_tagged_tester {
"{author={Foster, Nathan},title={Boomerang},journal={Principals},}"
<->
"jo - Principals
ti - Boomerang
au - Nathan Foster"
};;

quotient test bibtext_to_tagged_tester
{"{author={Foster, Nathan and Pierce, Benjamin and Bohannon, Aaron},}"
<->
"au - Nathan Foster
 au - Benjamin Pierce
 au - Aaron Bohannon",

"{title={Boomerang Resourceful Lenses For String Data},}"
<->
"ti - Boomerang Resourceful Lenses For String Data",

"{journal={Principals Of Programming Languages},}"
<->
"jo - Principals Of Programming Languages"
};;*)
